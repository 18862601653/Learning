# 容器之what，why，how

## 容器是什么
容器是一种轻量级、可移植、自包含的软件打包技术，使应用程序可以在几乎任何地方以相同的方式运行。开发人员在自己的笔记本上创建并测试好的容器，无需任何修改就能在生产系统的虚拟机、物理服务器或公有云主机上运行。

容器与虚拟机比较：

容器和虚拟机都为应用提供封装和隔离。

容器由两部分组成：

- 应用程序本身
- 依赖：比如应用程序需要的库或其他软件

容器在Host操作系统的用户空间中运行，与操作系统的其他进程隔离；而传统的虚拟化技术，如VMWare、KVM、Xen的目标是创建完整的虚拟机，为了运行应用，除了部署应用本身及其依赖（通常是几十MB），还得安装整个操作系统（几十GB）。

由于所有的容器共享同一个Host OS，这使得容器在体积上要比虚拟机小很多。另外，启动容器不需要启动整个操作系统，所以容器部署和启动速度更快，开销更小，也更容易迁移。

## 为什么要容器
容器使得软件具备超强的可移植性。

- 容器解决的问题
如今的系统在架构上较十年前已经变得非常复杂了。以前几乎所有的应用都采用三层架构（Presentation/Application/Data），系统部署到有限的几台物理服务器上（Web Server/Application Server/Database Server）。

现在开发人员通常采用多种服务(如MQ、Cache、DB）构建和组装应用，而且应用很可能会部署到不同的环境，比如虚拟服务器，私有云和公有云。一方面应用包含多种服务，这些服务有自己所依赖的库和软件包，另一方面存在多种部署环境，服务在运行时可能需要动态迁移到不同的环境中。

那么，如何让每种服务能够在所有的部署环境中顺利运行？

各种服务和环境通过排列组合会产生一个大的矩阵，开发人员在编写代码时需要考虑不同的运行环境，运维人员则需要为不同的服务和平台配置环境。这对双方来说都是一项困难而艰巨的任务。

为了解决这个问题，技术人员从传统的运输行业找到了答案，那就是集装箱的应用。

任何货物都可以被放到自己的集装箱中，集装箱在整个运输过程中都是密封的，只有到达最终目的地才会打开，标准集装箱可以被高效地装卸、重叠和长途运输。

Docker将集装箱的思想运用到了软件打包上，为代码提供了一个基于容器的标准化运输系统。Docker可以将任何应用及其依赖打包成一个轻量级、可移植、自包含的容器。容器可以在几乎所有的操作系统上运行。

- Docker与集装箱

|特性|集装箱|Docker|
|-|-|-|
|打包对象|几乎任何货物|任何软件及其依赖|
|硬件依赖|标准形状和接口允许集装箱被装卸到各种交通工具，整个运输过程无需打开|容器无需修改便可运行在几乎所有的平台上：虚拟机、物理机、公有云、私有云|
|隔离性|集装箱可以重叠起来一起运输|资源、网络、库都是隔离的，不会出现依赖问题|
|自动化|标准接口使集装箱很容易自动装卸和移动|提供run、start、stop等标准化操作，非常适合自动化|
|高效性|无需开箱，可在各种交通工具间快速搬运|轻量级，能够快速启动和迁移|
|职责分工|货主只需考虑把什么放到集装箱里，承运方只需关心怎样运输集装箱|开发人员只需考虑怎么写代码，运维人员只需关心如何配置基础设施|

- 容器的优势
对于开发人员来说，Build once，run anywhere

容器意味着环境隔离和可重复性，开发人员只需要为应用创建一次运行环境，然后打包成容器便可以在其他机器上运行。并且容器环境和所在的Host环境是隔离的，就像虚拟机一样，但更快更简单。

对于运维人员来说：Configure once，run anything

只需要配置好标准的runtime环境，服务器就可以运行任何容器。这使得运维人员的开发变得更高效，一致和可重复。容器消除了开发、测试、生产环境的不一致性。

## 容器是如何工作的


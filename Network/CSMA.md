# CSMA/CD



参考链接：http://wiki.mbalib.com/wiki/Carrier_sense_multiple_access/collision_detection

## CSMA/CD是啥
carrier sense multiple access/collision detection,载波侦听多路访问/冲突检测。CSMA/CD是一种争用型的介质访问控制协议。在以太网中，所有节点共享传输介质，如何保证传输介质有序、高效地为许多节点提供传输服务，是以太网介质访问控制协议要解决的问题。它起源于美国夏威夷大学开发的ALOHA网所采用的争用型协议，并在此基础上进行了改进，使之比ALOHA协议具有更高的介质利用率。对于每一个站而言，一旦检测到冲突，就放弃当前传送的任务。比如当两个站都检测信道空闲的时候，同时开始传送数据，那么它们几乎立刻检测到冲突产生，所以它们不应该继续传送帧，因为这样只会产生垃圾。即一旦检测到冲突，立即停止传送数据，这样可以快速地终止被损坏的帧从而节省时间和带宽。

## CSMA/CD工作原理
CSMA/CD是带有冲突检测的CSMA，其思想是：当一个节点要发送数据的时候，首先监听信道，如果信道空闲就发送，并继续监听，如果在发送过程中检测到冲突，就立即停发，等一段随机时间后重新尝试发送。

## CSMA/CD控制规程
控制规程的核心问题：解决在公共信道上以广播方式传输数据中可能出现的问题（主要是数据碰撞问题）
控制规程中包含四个处理内容：侦听、发送、检测、冲突处理
- 侦听：
  通过专门的检测机构，在站点准备发送数据之前先侦听是否有数据正在传送（信道是否忙）
  如果忙则进入退避处理程序，进而进一步反复进行侦听工作
  如果闲则采用一定的算法（X坚持）决定如何发送数据
- 发送：
  当确定要发送之后，通过发送机构，向总线发送数据
- 检测：
  数据发送后，可能会发送数据碰撞（冲突），因此要边发送，边接收，以判断是否冲突。
- 冲突处理：
  当确认发生冲突后，进入冲突处理程序。有两种突发情况：
  1. 侦听过程中发现线路忙
  2. 发送过程中发现数据碰撞
  如果在侦听过程中发现线路忙，则等待一个延时后再次侦听，如果还是忙，继续延迟等待，一直到可以发送为止。每次的延时时间可能不一样，由退避算法决定。
  如果在发送过程中发现数据碰撞，则发送阻塞信息，强化冲突，再进行侦听（同上），以待下次重新发送。

### 退避算法
当发生线路冲突时，如果各个站点采用相同的退避时间间隔，那么可能会造成第二次、第三次的冲突，因此，要让各个站点的退避时间间隔具有差异性。

截断的二进制指数退避算法：
- 确定基本退避时间2t，端到端的往返时间为2t，也就是一个争用期或冲突窗口，以太网是51.2μs
- 定义参数k，k为重传次数，k=min(重传次数，10)，所以k<=10
- 从离散的整数集合{0，1，2，···，(2^k-1)}中随机取出一个数r，等待时延为r*2t
- 当冲突次数大于10以后，都是从0~2^10-1个2t中随机选择一个作为等待时间
- 当冲突次数大于16，丢弃发送的帧，发送失败，发送错误报告

### 特殊阻塞信息
特殊阻塞信息是一组特殊数据信息，在发送数据后发现冲突时，立即发送特殊阻塞信息（通常是连续几个字节的1），以强化冲突信号，使线路上站点可以尽早探测到冲突的信号，从而减少造成新冲突的可能性。

### 冲突检测时间
冲突检测时间>=2α,α是指网络中最远两个站点传输线路延迟时间。该式表示检测时间必须保证最远站点发出数据产生冲突后被对方感知的最短时间。在2α时间内没有感知到冲突，则说明发出的数据没有发生冲突。（只要保证2α时间检测，没必要整个发送过程都检测）

### X-坚持的CSMA算法
在侦听中发现线路空闲时，不一定立刻发送数据，而是采用x坚持算法决定如何发送数据
- 非坚持的CSMA：线路忙，等待一段时间再侦听，不忙时，立刻发送，减少冲突，信道利用率降低
- 1坚持的CSMA：线路忙，继续侦听，不忙时，立刻发送，提高信道利用率，增加冲突
- p坚持的CSMA：线路忙，继续侦听，不忙时，以p的概率发送，以1-p的概率继续侦听，其中p是一个指定概率值，有效平衡，但复杂

### CSMA控制规程的特征
- 简单
- 具有广播功能
- 平均带宽：f=F/n
- 绝对平等，无优先级
- 低负荷高效，高负荷低效
- 延时时间不可预测
- 传输速率和传输距离为一定值
